



# Ray Tracing 4 (Monte Carlo Path Tracing)

![image-20210504173209068](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504173209068.png)

![image-20210504173333814](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504173333814.png)

![image-20210504173346886](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504173346886.png)

## Review - The Rendering Equation

![image-20210504173434358](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504173434358.png)

## Review - Probabilities

![image-20210504173459023](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504173459023.png)





# Monte Carlo Integration

* Why : 函数比较复杂，不好直接求定积分。
* 高数近似解法：黎曼积分
* 蒙特卡洛积分，使用概率来求定积分的值。

![image-20210504174043039](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504174043039.png)

![image-20210504174051569](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504174051569.png)

![image-20210504174119257](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504174119257.png)

![image-20210504174235947](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504174235947.png)

![image-20210504174245867](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504174245867.png)

![image-20210504174341631](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504174341631.png)





# Pathing Tracing

![image-20210504174710417](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504174710417.png)

![image-20210504174753657](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504174753657.png)

![image-20210504174930882](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504174930882.png)

![image-20210504175247177](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504175247177.png)

![image-20210504175448149](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504175448149.png)

![image-20210504175526012](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504175526012.png)

![image-20210504175715971](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504175715971.png)

![image-20210504175825861](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504175825861.png)

 ![image-20210504175923529](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504175923529.png)

 

![image-20210504180126010](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504180126010.png)

![image-20210504180437970](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504180437970.png)

![image-20210504180601198](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504180601198.png)

![image-20210504180756796](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504180756796.png)



## Ray Generation

![image-20210504180824974](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504180824974.png)

![image-20210504182651056](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504182651056.png)

![image-20210504182749313](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504182749313.png)

![image-20210504182853405](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504182853405.png)

![image-20210504183216913](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504183216913.png)

![image-20210504183347869](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504183347869.png)

![image-20210504183454377](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504183454377.png)

![image-20210504183612570](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504183612570.png)

* 为了不浪费 Ray 的数量，不能均匀采样，要根据光源优化。

# Sampling the Light

![image-20210504183716885](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504183716885.png)

![image-20210504183829896](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504183829896.png)

![image-20210504183913743](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504183913743.png)

![image-20210504184214955](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504184214955.png)

![image-20210504184315040](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504184315040.png)

![image-20210504184423477](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504184423477.png)

![image-20210504195825501](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504195825501.png)

![image-20210504200045092](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504200045092.png)

![image-20210504200147237](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504200147237.png)

![image-20210504200252361](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504200252361.png)

![image-20210504200425874](Media/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA/image-20210504200425874.png)

