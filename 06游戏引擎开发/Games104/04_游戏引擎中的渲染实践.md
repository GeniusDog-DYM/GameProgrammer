# Rendering On Game Engine

![image-20220405204022619](Media/04_游戏引擎中的渲染实践/image-20220405204022619.png)

需求很明确

不关注硬件实现，而是关注算法和数学正确性。辐射度算法

是否实时，可交互，离线

数据量太大内存装不下，需要多台机器离散

### GAMES 101



# Challenges on Game Rendering

1. Tens of thousands of objects with dozens type of effects，成千上万的物体采用不同的算法

2. 运行在不同的计算机架构，由不同的 CPU 和 GPU 组成
3. 帧率稳定，越来越高的帧率，HD 4K 8K
4. 受限 CPU 和内存带宽影响，绘制系统一般占用 10%~20% 的 CPU ，剩下的留给其它 Gameplay 系统



## 概念

不是理论模型，而是工程实践过的，经过行业 30 年迭代优化的软件工程系统。

理论更新换代的速度不会太快，工程实践科学最前沿的更新换代速度非常快，工程实践演化随着硬件和游戏环境变化。

工程上为什么是这么做？

![image-20220405210131814](Media/04_游戏引擎中的渲染实践/image-20220405210131814.png)

![image-20220405210139654](Media/04_游戏引擎中的渲染实践/image-20220405210139654.png)



# Building Blocks of Rendering

![image-20220405210231231](Media/04_游戏引擎中的渲染实践/image-20220405210231231.png)

![image-20220405210306462](Media/04_游戏引擎中的渲染实践/image-20220405210306462.png)

![image-20220405211051370](Media/04_游戏引擎中的渲染实践/image-20220405211051370.png)

![image-20220405211220213](Media/04_游戏引擎中的渲染实践/image-20220405211220213.png)

## 了解 GPU

![image-20220405211515487](Media/04_游戏引擎中的渲染实践/image-20220405211515487.png)

![image-20220405211539523](Media/04_游戏引擎中的渲染实践/image-20220405211539523.png)

![image-20220405211909312](Media/04_游戏引擎中的渲染实践/image-20220405211909312.png)

![image-20220405212200628](Media/04_游戏引擎中的渲染实践/image-20220405212200628.png)

原则：尽可能单向流动，CPU 不从 GPU 读数据

![image-20220405212429127](Media/04_游戏引擎中的渲染实践/image-20220405212429127.png)

![image-20220405212612775](Media/04_游戏引擎中的渲染实践/image-20220405212612775.png)

![image-20220405212709823](Media/04_游戏引擎中的渲染实践/image-20220405212709823.png)

![image-20220405212731851](Media/04_游戏引擎中的渲染实践/image-20220405212731851.png)

![image-20220405212741602](Media/04_游戏引擎中的渲染实践/image-20220405212741602.png)



# Renderable 可渲染物体

![image-20220405212932296](Media/04_游戏引擎中的渲染实践/image-20220405212932296.png)

![image-20220405213002443](Media/04_游戏引擎中的渲染实践/image-20220405213002443.png)

![image-20220405213131325](Media/04_游戏引擎中的渲染实践/image-20220405213131325.png)

![image-20220405213151258](Media/04_游戏引擎中的渲染实践/image-20220405213151258.png)

![image-20220405213758868](Media/04_游戏引擎中的渲染实践/image-20220405213758868.png)

![image-20220405213831340](Media/04_游戏引擎中的渲染实践/image-20220405213831340.png)

![image-20220405213856534](Media/04_游戏引擎中的渲染实践/image-20220405213856534.png)

![image-20220405213940324](Media/04_游戏引擎中的渲染实践/image-20220405213940324.png)

![image-20220405214029342](Media/04_游戏引擎中的渲染实践/image-20220405214029342.png)

# Render Objects in Engine

![image-20220405214224109](Media/04_游戏引擎中的渲染实践/image-20220405214224109.png)

![image-20220405214313771](Media/04_游戏引擎中的渲染实践/image-20220405214313771.png)

![image-20220405214412652](Media/04_游戏引擎中的渲染实践/image-20220405214412652.png)

![image-20220405214546421](Media/04_游戏引擎中的渲染实践/image-20220405214546421.png)

![image-20220405214600237](Media/04_游戏引擎中的渲染实践/image-20220405214600237.png)

![image-20220405214620099](Media/04_游戏引擎中的渲染实践/image-20220405214620099.png)

![image-20220405214901456](Media/04_游戏引擎中的渲染实践/image-20220405214901456.png)

拿起一支笔，就把一样的东西都画完。不要来回换笔

![image-20220405214932164](Media/04_游戏引擎中的渲染实践/image-20220405214932164.png)



# Visibility Culling 可见性裁剪

![image-20220405215624110](Media/04_游戏引擎中的渲染实践/image-20220405215624110.png)

![image-20220405215638413](Media/04_游戏引擎中的渲染实践/image-20220405215638413.png)

![image-20220405215744623](Media/04_游戏引擎中的渲染实践/image-20220405215744623.png)

![image-20220405215851726](Media/04_游戏引擎中的渲染实践/image-20220405215851726.png)

BVH 运算效率不是最高，当物体移动后重新构建的效率高。还有很多其它算法

![image-20220405220022149](Media/04_游戏引擎中的渲染实践/image-20220405220022149.png)

PVS 作者卡马克，可以写来练手

![image-20220405220243310](Media/04_游戏引擎中的渲染实践/image-20220405220243310.png)

现在游戏用 PVS 的很少，但是思想非常有用，控制子关卡的加载

![image-20220405220318854](Media/04_游戏引擎中的渲染实践/image-20220405220318854.png)

现在最新的做法，直接 GPU 并行计算给出结果。不需要那些精巧的算法，compute shader 也可以在 GPU 上构建算法

Early Z

![image-20220405220449424](Media/04_游戏引擎中的渲染实践/image-20220405220449424.png)

# Texture Compression 贴图压缩

![image-20220405220913849](Media/04_游戏引擎中的渲染实践/image-20220405220913849.png)

![image-20220405221058463](Media/04_游戏引擎中的渲染实践/image-20220405221058463.png)

# Authoring Tools of Modeling 建模工具

![image-20220405221317425](Media/04_游戏引擎中的渲染实践/image-20220405221317425.png)

![image-20220405221331053](Media/04_游戏引擎中的渲染实践/image-20220405221331053.png)

![image-20220405221353496](Media/04_游戏引擎中的渲染实践/image-20220405221353496.png)

![image-20220405221448441](Media/04_游戏引擎中的渲染实践/image-20220405221448441.png)

![image-20220405221523679](Media/04_游戏引擎中的渲染实践/image-20220405221523679.png)



# Cluster-Based Mesh Pipeline 新的模型管线

![image-20220405221647301](Media/04_游戏引擎中的渲染实践/image-20220405221647301.png)

![image-20220405221811331](Media/04_游戏引擎中的渲染实践/image-20220405221811331.png)

![image-20220405222027982](Media/04_游戏引擎中的渲染实践/image-20220405222027982.png)

![image-20220405222234033](Media/04_游戏引擎中的渲染实践/image-20220405222234033.png)

![image-20220405222310691](Media/04_游戏引擎中的渲染实践/image-20220405222310691.png)

# Take Away

![image-20220405222355395](Media/04_游戏引擎中的渲染实践/image-20220405222355395.png)

工程科学，深刻依赖硬件架构

Mesh 模型材质的关系

绘制的时候尽可能减少，提高性能。让计算机 Do nothing

越来越多的复杂运算从 CPU 转移到 GPU，GPU Driven

