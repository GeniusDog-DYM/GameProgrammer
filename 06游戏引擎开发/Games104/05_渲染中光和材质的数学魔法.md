![image-20220417163400367](Media/05_渲染中光和材质的数学魔法/image-20220417163400367.png)



硬核的知识讲不了太深，讲故事，梳理发展历程



# 渲染方程及挑战

![image-20220417163657964](Media/05_渲染中光和材质的数学魔法/image-20220417163657964.png)

![image-20220417234634611](Media/05_渲染中光和材质的数学魔法/image-20220417234634611.png)

![image-20220417234901938](Media/05_渲染中光和材质的数学魔法/image-20220417234901938.png)

35 年前给了一条理论方程，各种 BRDF 实现，又爱又恨

![image-20220417235140281](Media/05_渲染中光和材质的数学魔法/image-20220417235140281.png)

![image-20220417235230541](Media/05_渲染中光和材质的数学魔法/image-20220417235230541.png)

![image-20220417235421721](Media/05_渲染中光和材质的数学魔法/image-20220417235421721.png)

![image-20220417235508965](Media/05_渲染中光和材质的数学魔法/image-20220417235508965.png)

作者感觉最痛苦的 3 点总结，一家之言

![image-20220417235628142](Media/05_渲染中光和材质的数学魔法/image-20220417235628142.png)



# 基础光照解决方案

![image-20220417235924908](Media/05_渲染中光和材质的数学魔法/image-20220417235924908.png)

![image-20220418000102738](Media/05_渲染中光和材质的数学魔法/image-20220418000102738.png)

![image-20220418000119869](Media/05_渲染中光和材质的数学魔法/image-20220418000119869.png)

BRDF 的发展历程百花齐放，最前沿的已经到了波动理论，光会互相干涉

作者更加喜欢经验派的模型

光可叠加性

![image-20220418000239113](Media/05_渲染中光和材质的数学魔法/image-20220418000239113.png)

![image-20220418000617853](Media/05_渲染中光和材质的数学魔法/image-20220418000617853.png)

![image-20220418000911262](Media/05_渲染中光和材质的数学魔法/image-20220418000911262.png)

![image-20220418001026139](Media/05_渲染中光和材质的数学魔法/image-20220418001026139.png)

![image-20220418001151820](Media/05_渲染中光和材质的数学魔法/image-20220418001151820.png)

![image-20220418001407854](Media/05_渲染中光和材质的数学魔法/image-20220418001407854.png)

* No.1a Visibility to Lights
* No.1b Light Source Complexity
* No.2 How to do Integral Efficiently on Hardware
* No.3 Any matter will be light source



# 基于预计算的全局光照

3A 给自己找麻烦，放着传统的 3 件套不用，3A 的文化要搞出新花样 

2003 ~ 2004 突飞猛进

![image-20220418002002089](Media/05_渲染中光和材质的数学魔法/image-20220418002002089.png)

![image-20220418002036899](Media/05_渲染中光和材质的数学魔法/image-20220418002036899.png)

![image-20220418002047410](Media/05_渲染中光和材质的数学魔法/image-20220418002047410.png)

## Pre-computed Global Illumination

空间换时间

全局光照

![image-20220418002242400](Media/05_渲染中光和材质的数学魔法/image-20220418002242400.png)

![image-20220418002416689](Media/05_渲染中光和材质的数学魔法/image-20220418002416689.png)

比起对所有采样点进行加权平均，傅里叶变换到频域，卷积运算效率会大大提升

![image-20220418002930447](Media/05_渲染中光和材质的数学魔法/image-20220418002930447.png)

球谐函数

![image-20220418002953878](Media/05_渲染中光和材质的数学魔法/image-20220418002953878.png)

![image-20220418003201653](Media/05_渲染中光和材质的数学魔法/image-20220418003201653.png)

![image-20220418003335765](Media/05_渲染中光和材质的数学魔法/image-20220418003335765.png)

![image-20220418003429051](Media/05_渲染中光和材质的数学魔法/image-20220418003429051.png)

![image-20220418003436006](Media/05_渲染中光和材质的数学魔法/image-20220418003436006.png)

二阶连续，用几个参数就能还原出大概的光强信息

![image-20220418003525137](Media/05_渲染中光和材质的数学魔法/image-20220418003525137.png)

EA. (2018). Precomputed Global Illumination in Frostbite. Retrieved from https://www.ea.com/frostbite/news/precomputed-global-illumination-in-frostbite



## Light Map

![image-20220418003817968](Media/05_渲染中光和材质的数学魔法/image-20220418003817968.png)

卡马克之前算 Shader 算不过来，就已经提前采用预计算了

把整个场景的光照烘焙到一张图上

![image-20220418004014419](Media/05_渲染中光和材质的数学魔法/image-20220418004014419.png)

参数化展开均衡还挺复杂的，DX 当年还专门开发了 API 来做这个事情

![image-20220418004237395](Media/05_渲染中光和材质的数学魔法/image-20220418004237395.png)

烘焙出的效果很好，但是开发效率很低

![image-20220418005137090](Media/05_渲染中光和材质的数学魔法/image-20220418005137090.png)

![image-20220418005147215](Media/05_渲染中光和材质的数学魔法/image-20220418005147215.png)

![image-20220418005205048](Media/05_渲染中光和材质的数学魔法/image-20220418005205048.png)

Light Map 以后可能会被淘汰掉，但是思想很重要

* 空间换时间

* 把个整个游戏场景参数化到一个二维或者三维的贴图上



## Light Probe

![image-20220418005722978](Media/05_渲染中光和材质的数学魔法/image-20220418005722978.png)

自动化生成

![image-20220418005902954](Media/05_渲染中光和材质的数学魔法/image-20220418005902954.png)

光照是低频信息，可以采样精度很低，但要摆的密集

反射是高频信息，需要高精度，密度会低

![image-20220418010111187](Media/05_渲染中光和材质的数学魔法/image-20220418010111187.png)

![image-20220418010127304](Media/05_渲染中光和材质的数学魔法/image-20220418010127304.png)

可以处理动态物体，根据帧率情况延迟处理变化。效果比 Light Map 要差一些（软阴影，重叠等等）



# 基于物理的材质 Physical-Based Material

微平面理论

![image-20220418010552140](Media/05_渲染中光和材质的数学魔法/image-20220418010552140.png)

![image-20220418010647474](Media/05_渲染中光和材质的数学魔法/image-20220418010647474.png)